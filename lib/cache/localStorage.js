"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getGlobalCache = getGlobalCache;
exports.setGlobalCacheName = setGlobalCacheName;
exports.add = add;
exports.get = get;
exports.remove = remove;

var Lib = _interopRequireWildcard(require("../common/lib"));

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }

var globalCacheName = "x-js-kit-localcache";

/**
 * 返回全局缓存对象
 */
function getGlobalCache() {
  var cacheValue = localStorage.getItem(globalCacheName);

  if (!cacheValue) {
    return null;
  }

  return JSON.parse(cacheValue);
}
/**
 * 修改localStorage缓存的默认名称
 */


function setGlobalCacheName(name) {
  var oldValue = localStorage.getItem(globalCacheName);
  localStorage.removeItem(globalCacheName);
  globalCacheName = name;
  localStorage.setItem(globalCacheName, oldValue);
}
/**
 * 添加数据至缓存
 */


function add(key, value) {
  var cache = getGlobalCache();

  if (!cache) {
    return;
  }

  cache.items[key] = value;
  localStorage.setItem(globalCacheName, JSON.stringify(cache));
}
/**
 * 读取指定缓存
 */


function get(key) {
  var cache = getGlobalCache();

  if (!cache) {
    return null;
  }

  var item = cache.items[key];

  if (!item) {
    return null;
  }

  if (item.expire && item.expire < new Date().valueOf()) {
    remove(key);
    return null;
  }

  return item;
}
/**
 * 删除指定缓存
 */


function remove(key) {
  var cache = getGlobalCache();

  if (!cache) {
    return null;
  }

  delete cache.items[key];
  localStorage.setItem(globalCacheName, JSON.stringify(cache));
}

(function () {
  if (!Lib.getLocalStorage()) {
    return;
  } //设置默认缓存值


  var defaultGlobalLocalStorage = {
    time: new Date().valueOf(),
    items: {}
  };

  if (!localStorage.getItem(globalCacheName)) {
    localStorage.setItem(globalCacheName, JSON.stringify(defaultGlobalLocalStorage));
  } //清理过期缓存


  var ch = getGlobalCache();
  if (!ch) return;
  Object.keys(ch.items).forEach(function (key) {
    var item = ch.items[key];

    if (!item || !item.expire) {
      return;
    }

    if (item.expire < new Date().valueOf()) {
      remove(key);
    }
  });
})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jYWNoZS9sb2NhbFN0b3JhZ2UudHMiXSwibmFtZXMiOlsiZ2xvYmFsQ2FjaGVOYW1lIiwiZ2V0R2xvYmFsQ2FjaGUiLCJjYWNoZVZhbHVlIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsIkpTT04iLCJwYXJzZSIsInNldEdsb2JhbENhY2hlTmFtZSIsIm5hbWUiLCJvbGRWYWx1ZSIsInJlbW92ZUl0ZW0iLCJzZXRJdGVtIiwiYWRkIiwia2V5IiwidmFsdWUiLCJjYWNoZSIsIml0ZW1zIiwic3RyaW5naWZ5IiwiZ2V0IiwiaXRlbSIsImV4cGlyZSIsIkRhdGUiLCJ2YWx1ZU9mIiwicmVtb3ZlIiwiTGliIiwiZ2V0TG9jYWxTdG9yYWdlIiwiZGVmYXVsdEdsb2JhbExvY2FsU3RvcmFnZSIsInRpbWUiLCJjaCIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOzs7O0FBRUEsSUFBSUEsZUFBZSxHQUFHLHFCQUF0Qjs7QUF1QkE7OztBQUdPLFNBQVNDLGNBQVQsR0FBb0Q7QUFDdkQsTUFBTUMsVUFBVSxHQUFHQyxZQUFZLENBQUNDLE9BQWIsQ0FBcUJKLGVBQXJCLENBQW5COztBQUNBLE1BQUksQ0FBQ0UsVUFBTCxFQUFpQjtBQUNiLFdBQU8sSUFBUDtBQUNIOztBQUNELFNBQU9HLElBQUksQ0FBQ0MsS0FBTCxDQUFXSixVQUFYLENBQVA7QUFDSDtBQUNEOzs7OztBQUdPLFNBQVNLLGtCQUFULENBQTRCQyxJQUE1QixFQUEwQztBQUM3QyxNQUFNQyxRQUFRLEdBQUdOLFlBQVksQ0FBQ0MsT0FBYixDQUFxQkosZUFBckIsQ0FBakI7QUFDQUcsRUFBQUEsWUFBWSxDQUFDTyxVQUFiLENBQXdCVixlQUF4QjtBQUNBQSxFQUFBQSxlQUFlLEdBQUdRLElBQWxCO0FBQ0FMLEVBQUFBLFlBQVksQ0FBQ1EsT0FBYixDQUFxQlgsZUFBckIsRUFBc0NTLFFBQXRDO0FBQ0g7QUFDRDs7Ozs7QUFHTyxTQUFTRyxHQUFULENBQWFDLEdBQWIsRUFBMEJDLEtBQTFCLEVBQWtEO0FBQ3JELE1BQU1DLEtBQUssR0FBR2QsY0FBYyxFQUE1Qjs7QUFDQSxNQUFJLENBQUNjLEtBQUwsRUFBWTtBQUNSO0FBQ0g7O0FBQ0RBLEVBQUFBLEtBQUssQ0FBQ0MsS0FBTixDQUFZSCxHQUFaLElBQW1CQyxLQUFuQjtBQUNBWCxFQUFBQSxZQUFZLENBQUNRLE9BQWIsQ0FBcUJYLGVBQXJCLEVBQXNDSyxJQUFJLENBQUNZLFNBQUwsQ0FBZUYsS0FBZixDQUF0QztBQUNIO0FBQ0Q7Ozs7O0FBR08sU0FBU0csR0FBVCxDQUFhTCxHQUFiLEVBQWtEO0FBQ3JELE1BQU1FLEtBQUssR0FBR2QsY0FBYyxFQUE1Qjs7QUFDQSxNQUFJLENBQUNjLEtBQUwsRUFBWTtBQUNSLFdBQU8sSUFBUDtBQUNIOztBQUNELE1BQU1JLElBQUksR0FBR0osS0FBSyxDQUFDQyxLQUFOLENBQVlILEdBQVosQ0FBYjs7QUFDQSxNQUFJLENBQUNNLElBQUwsRUFBVztBQUNQLFdBQU8sSUFBUDtBQUNIOztBQUNELE1BQUlBLElBQUksQ0FBQ0MsTUFBTCxJQUFlRCxJQUFJLENBQUNDLE1BQUwsR0FBYyxJQUFJQyxJQUFKLEdBQVdDLE9BQVgsRUFBakMsRUFBdUQ7QUFDbkRDLElBQUFBLE1BQU0sQ0FBQ1YsR0FBRCxDQUFOO0FBQ0EsV0FBTyxJQUFQO0FBQ0g7O0FBQ0QsU0FBT00sSUFBUDtBQUNIO0FBQ0Q7Ozs7O0FBR08sU0FBU0ksTUFBVCxDQUFnQlYsR0FBaEIsRUFBNkI7QUFDaEMsTUFBTUUsS0FBSyxHQUFHZCxjQUFjLEVBQTVCOztBQUNBLE1BQUksQ0FBQ2MsS0FBTCxFQUFZO0FBQ1IsV0FBTyxJQUFQO0FBQ0g7O0FBQ0QsU0FBT0EsS0FBSyxDQUFDQyxLQUFOLENBQVlILEdBQVosQ0FBUDtBQUNBVixFQUFBQSxZQUFZLENBQUNRLE9BQWIsQ0FBcUJYLGVBQXJCLEVBQXNDSyxJQUFJLENBQUNZLFNBQUwsQ0FBZUYsS0FBZixDQUF0QztBQUNIOztBQUVELENBQUMsWUFBTTtBQUNILE1BQUksQ0FBQ1MsR0FBRyxDQUFDQyxlQUFKLEVBQUwsRUFBNEI7QUFDeEI7QUFDSCxHQUhFLENBSUg7OztBQUNBLE1BQU1DLHlCQUEwQyxHQUFHO0FBQy9DQyxJQUFBQSxJQUFJLEVBQUUsSUFBSU4sSUFBSixHQUFXQyxPQUFYLEVBRHlDO0FBRS9DTixJQUFBQSxLQUFLLEVBQUU7QUFGd0MsR0FBbkQ7O0FBSUEsTUFBSSxDQUFDYixZQUFZLENBQUNDLE9BQWIsQ0FBcUJKLGVBQXJCLENBQUwsRUFBNEM7QUFDeENHLElBQUFBLFlBQVksQ0FBQ1EsT0FBYixDQUFxQlgsZUFBckIsRUFBc0NLLElBQUksQ0FBQ1ksU0FBTCxDQUFlUyx5QkFBZixDQUF0QztBQUNILEdBWEUsQ0FZSDs7O0FBQ0EsTUFBTUUsRUFBRSxHQUFHM0IsY0FBYyxFQUF6QjtBQUNBLE1BQUksQ0FBQzJCLEVBQUwsRUFBUztBQUNUQyxFQUFBQSxNQUFNLENBQUNDLElBQVAsQ0FBWUYsRUFBRSxDQUFDWixLQUFmLEVBQXNCZSxPQUF0QixDQUE4QixVQUFBbEIsR0FBRyxFQUFJO0FBQ2pDLFFBQU1NLElBQUksR0FBR1MsRUFBRSxDQUFDWixLQUFILENBQVNILEdBQVQsQ0FBYjs7QUFDQSxRQUFJLENBQUNNLElBQUQsSUFBUyxDQUFDQSxJQUFJLENBQUNDLE1BQW5CLEVBQTJCO0FBQ3ZCO0FBQ0g7O0FBQ0QsUUFBSUQsSUFBSSxDQUFDQyxNQUFMLEdBQWMsSUFBSUMsSUFBSixHQUFXQyxPQUFYLEVBQWxCLEVBQXdDO0FBQ3BDQyxNQUFBQSxNQUFNLENBQUNWLEdBQUQsQ0FBTjtBQUNIO0FBQ0osR0FSRDtBQVNILENBeEJEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgIExpYiBmcm9tIFwiLi4vY29tbW9uL2xpYlwiXHJcblxyXG5sZXQgZ2xvYmFsQ2FjaGVOYW1lID0gXCJ4LWpzLWtpdC1sb2NhbGNhY2hlXCJcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSXRlbUNvbnRlbnRUeXBlIHtcclxuICAgIC8qKlxyXG4gICAgICog5YW35L2T55qE57yT5a2Y5YC8XHJcbiAgICAgKi9cclxuICAgIHZhbHVlOiBhbnlcclxuICAgIC8qKlxyXG4gICAgICog6L+H5pyf5pe26Ze077yM6Iul5LiN5oyH5a6a77yM5YiZ5peg6L+H5pyf5pe26Ze077yI5q2k5pe26Ze05Li677ya5LuOMTk3MOW5tDHmnIgx5pelMOaXtjDliIYw56eS77yIVVRD77yM5Y2z5Y2P6LCD5LiW55WM5pe277yJ5Yiw6K+l5pel5pyf55qE5q+r56eS5pWw44CC5aaC77yabmV3IERhdGUoKS52YWx1ZU9mKCnvvIlcclxuICAgICAqL1xyXG4gICAgZXhwaXJlPzogbnVtYmVyXHJcbn1cclxuZXhwb3J0IGludGVyZmFjZSBHbG9iYWxDYWNoZVR5cGUge1xyXG4gICAgLyoqXHJcbiAgICAgKiDml7bpl7RcclxuICAgICAqL1xyXG4gICAgdGltZTogbnVtYmVyLFxyXG4gICAgLyoqXHJcbiAgICAgKiDmiYDmnInnvJPlrZjpoblcclxuICAgICAqL1xyXG4gICAgaXRlbXM6IHsgW2tleTogc3RyaW5nXTogSXRlbUNvbnRlbnRUeXBlIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIOi/lOWbnuWFqOWxgOe8k+WtmOWvueixoVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEdsb2JhbENhY2hlKCk6IChHbG9iYWxDYWNoZVR5cGUgfCBudWxsKSB7XHJcbiAgICBjb25zdCBjYWNoZVZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oZ2xvYmFsQ2FjaGVOYW1lKSBhcyBzdHJpbmdcclxuICAgIGlmICghY2FjaGVWYWx1ZSkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIEpTT04ucGFyc2UoY2FjaGVWYWx1ZSkgYXMgR2xvYmFsQ2FjaGVUeXBlXHJcbn1cclxuLyoqXHJcbiAqIOS/ruaUuWxvY2FsU3RvcmFnZee8k+WtmOeahOm7mOiupOWQjeensFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHNldEdsb2JhbENhY2hlTmFtZShuYW1lOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IG9sZFZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oZ2xvYmFsQ2FjaGVOYW1lKSBhcyBzdHJpbmc7XHJcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShnbG9iYWxDYWNoZU5hbWUpXHJcbiAgICBnbG9iYWxDYWNoZU5hbWUgPSBuYW1lXHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShnbG9iYWxDYWNoZU5hbWUsIG9sZFZhbHVlKTtcclxufVxyXG4vKipcclxuICog5re75Yqg5pWw5o2u6Iez57yT5a2YXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gYWRkKGtleTogc3RyaW5nLCB2YWx1ZTogSXRlbUNvbnRlbnRUeXBlKSB7XHJcbiAgICBjb25zdCBjYWNoZSA9IGdldEdsb2JhbENhY2hlKClcclxuICAgIGlmICghY2FjaGUpIHtcclxuICAgICAgICByZXR1cm5cclxuICAgIH1cclxuICAgIGNhY2hlLml0ZW1zW2tleV0gPSB2YWx1ZVxyXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oZ2xvYmFsQ2FjaGVOYW1lLCBKU09OLnN0cmluZ2lmeShjYWNoZSkpXHJcbn1cclxuLyoqXHJcbiAqIOivu+WPluaMh+Wumue8k+WtmFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldChrZXk6IHN0cmluZyk6IEl0ZW1Db250ZW50VHlwZSB8IG51bGwge1xyXG4gICAgY29uc3QgY2FjaGUgPSBnZXRHbG9iYWxDYWNoZSgpXHJcbiAgICBpZiAoIWNhY2hlKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGxcclxuICAgIH1cclxuICAgIGNvbnN0IGl0ZW0gPSBjYWNoZS5pdGVtc1trZXldXHJcbiAgICBpZiAoIWl0ZW0pIHtcclxuICAgICAgICByZXR1cm4gbnVsbFxyXG4gICAgfVxyXG4gICAgaWYgKGl0ZW0uZXhwaXJlICYmIGl0ZW0uZXhwaXJlIDwgbmV3IERhdGUoKS52YWx1ZU9mKCkpIHtcclxuICAgICAgICByZW1vdmUoa2V5KVxyXG4gICAgICAgIHJldHVybiBudWxsXHJcbiAgICB9XHJcbiAgICByZXR1cm4gaXRlbVxyXG59XHJcbi8qKlxyXG4gKiDliKDpmaTmjIflrprnvJPlrZhcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiByZW1vdmUoa2V5OiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGNhY2hlID0gZ2V0R2xvYmFsQ2FjaGUoKVxyXG4gICAgaWYgKCFjYWNoZSkge1xyXG4gICAgICAgIHJldHVybiBudWxsXHJcbiAgICB9XHJcbiAgICBkZWxldGUgY2FjaGUuaXRlbXNba2V5XVxyXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oZ2xvYmFsQ2FjaGVOYW1lLCBKU09OLnN0cmluZ2lmeShjYWNoZSkpXHJcbn1cclxuXHJcbigoKSA9PiB7XHJcbiAgICBpZiAoIUxpYi5nZXRMb2NhbFN0b3JhZ2UoKSkge1xyXG4gICAgICAgIHJldHVyblxyXG4gICAgfVxyXG4gICAgLy/orr7nva7pu5jorqTnvJPlrZjlgLxcclxuICAgIGNvbnN0IGRlZmF1bHRHbG9iYWxMb2NhbFN0b3JhZ2U6IEdsb2JhbENhY2hlVHlwZSA9IHtcclxuICAgICAgICB0aW1lOiBuZXcgRGF0ZSgpLnZhbHVlT2YoKSxcclxuICAgICAgICBpdGVtczoge31cclxuICAgIH1cclxuICAgIGlmICghbG9jYWxTdG9yYWdlLmdldEl0ZW0oZ2xvYmFsQ2FjaGVOYW1lKSkge1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGdsb2JhbENhY2hlTmFtZSwgSlNPTi5zdHJpbmdpZnkoZGVmYXVsdEdsb2JhbExvY2FsU3RvcmFnZSkpXHJcbiAgICB9XHJcbiAgICAvL+a4heeQhui/h+acn+e8k+WtmFxyXG4gICAgY29uc3QgY2ggPSBnZXRHbG9iYWxDYWNoZSgpXHJcbiAgICBpZiAoIWNoKSByZXR1cm5cclxuICAgIE9iamVjdC5rZXlzKGNoLml0ZW1zKS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgICAgY29uc3QgaXRlbSA9IGNoLml0ZW1zW2tleV1cclxuICAgICAgICBpZiAoIWl0ZW0gfHwgIWl0ZW0uZXhwaXJlKSB7XHJcbiAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaXRlbS5leHBpcmUgPCBuZXcgRGF0ZSgpLnZhbHVlT2YoKSkge1xyXG4gICAgICAgICAgICByZW1vdmUoa2V5KVxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbn0pKCkiXX0=