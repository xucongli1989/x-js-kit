"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.toEntity = toEntity;
exports.toCounterEntity = toCounterEntity;
exports.parse = parse;

var _data = require("../common/data");

var _convert = require("../common/convert");

/**
 * 一年的毫秒数（按360天计算）
 */
var msPerYear = 31104000000;
/**
 * 一个月的毫秒数（按30天计算）
 */

var msPerMonth = 2592000000;
/**
 * 一天的毫秒数
 */

var msPerDay = 86400000;
/**
 * 一小时的毫秒数
 */

var msPerHour = 3600000;
/**
 * 一分钟的毫秒数
 */

var msPerMin = 60000;
/**
 * 一秒钟的毫秒数
 */

var msPerSec = 1000;
/**
 * 返回时间实体对象
 */

function toEntity(dt) {
  var model = {};
  model.year = dt.getFullYear();
  model.month = dt.getMonth() + 1;
  model.day = dt.getDate();
  model.hour = dt.getHours();
  model.min = dt.getMinutes();
  model.second = dt.getSeconds();
  model.millisecond = dt.getMilliseconds();
  model.week = dt.getDay();
  return model;
}
/**
 * 根据毫秒数返回用于计时统计的实体
 */


function toCounterEntity(ms) {
  var model = {};
  model.year = 0;
  model.month = 0;
  model.day = 0;
  model.hour = 0;
  model.min = 0;
  model.second = 0;
  model.millisecond = 0;

  if (ms <= 0) {
    return model;
  }

  if (ms >= msPerYear) {
    model.year = (0, _convert.toInt)(ms / msPerYear);
  }

  if (ms >= msPerMonth) {
    model.month = (0, _convert.toInt)(ms % msPerYear / msPerMonth);
  }

  if (ms >= msPerDay) {
    model.day = (0, _convert.toInt)(ms % msPerYear % msPerMonth / msPerDay);
  }

  if (ms >= msPerHour) {
    model.hour = (0, _convert.toInt)(ms % msPerYear % msPerMonth % msPerDay / msPerHour);
  }

  if (ms >= msPerMin) {
    model.min = (0, _convert.toInt)(ms % msPerYear % msPerMonth % msPerDay % msPerHour / msPerMin);
  }

  if (ms >= msPerSec) {
    model.second = (0, _convert.toInt)(ms % msPerYear % msPerMonth % msPerDay % msPerHour % msPerMin / msPerSec);
  }

  model.millisecond = (0, _convert.toInt)(ms % msPerYear % msPerMonth % msPerDay % msPerHour % msPerMin % msPerSec);
  return model;
}
/**
 * 将字符串"/Date(...)/"的日期转为js Date对象
 * @param dateStr date字符串，如"/Date(1441036800000)/"
 * @returns 如果转换成功，则返回Date对象，否则返回null
 */


function parse(dateStr) {
  if (!dateStr || !(0, _data.isString)(dateStr)) {
    return null;
  }

  var date = null;
  var mts = dateStr.match(/(\/Date\((\d+)\)\/)/);

  if (mts && mts.length >= 3) {
    date = new Date(parseInt(mts[2]));
  }

  if (!(0, _data.isDate)(date)) {
    return null;
  }

  return date;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kYXRlL2NvbnZlcnQudHMiXSwibmFtZXMiOlsibXNQZXJZZWFyIiwibXNQZXJNb250aCIsIm1zUGVyRGF5IiwibXNQZXJIb3VyIiwibXNQZXJNaW4iLCJtc1BlclNlYyIsInRvRW50aXR5IiwiZHQiLCJtb2RlbCIsInllYXIiLCJnZXRGdWxsWWVhciIsIm1vbnRoIiwiZ2V0TW9udGgiLCJkYXkiLCJnZXREYXRlIiwiaG91ciIsImdldEhvdXJzIiwibWluIiwiZ2V0TWludXRlcyIsInNlY29uZCIsImdldFNlY29uZHMiLCJtaWxsaXNlY29uZCIsImdldE1pbGxpc2Vjb25kcyIsIndlZWsiLCJnZXREYXkiLCJ0b0NvdW50ZXJFbnRpdHkiLCJtcyIsInBhcnNlIiwiZGF0ZVN0ciIsImRhdGUiLCJtdHMiLCJtYXRjaCIsImxlbmd0aCIsIkRhdGUiLCJwYXJzZUludCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQ0E7O0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBTUEsU0FBUyxHQUFHLFdBQWxCO0FBQ0E7QUFDQTtBQUNBOztBQUNBLElBQU1DLFVBQVUsR0FBRyxVQUFuQjtBQUNBO0FBQ0E7QUFDQTs7QUFDQSxJQUFNQyxRQUFRLEdBQUcsUUFBakI7QUFDQTtBQUNBO0FBQ0E7O0FBQ0EsSUFBTUMsU0FBUyxHQUFHLE9BQWxCO0FBQ0E7QUFDQTtBQUNBOztBQUNBLElBQU1DLFFBQVEsR0FBRyxLQUFqQjtBQUNBO0FBQ0E7QUFDQTs7QUFDQSxJQUFNQyxRQUFRLEdBQUcsSUFBakI7QUFFQTtBQUNBO0FBQ0E7O0FBQ08sU0FBU0MsUUFBVCxDQUFrQkMsRUFBbEIsRUFBZ0Q7QUFDbkQsTUFBTUMsS0FBSyxHQUFHLEVBQWQ7QUFDQUEsRUFBQUEsS0FBSyxDQUFDQyxJQUFOLEdBQWFGLEVBQUUsQ0FBQ0csV0FBSCxFQUFiO0FBQ0FGLEVBQUFBLEtBQUssQ0FBQ0csS0FBTixHQUFlSixFQUFFLENBQUNLLFFBQUgsS0FBZ0IsQ0FBL0I7QUFDQUos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QSxPQUFELElBQVksQ0FBQyxvQkFBU0EsT0FBVCxDQUFqQixFQUFvQztBQUNoQyxXQUFPLElBQVA7QUFDSDs7QUFDRCxNQUFJQyxJQUFJLEdBQUcsSUFBWDtBQUNBLE1BQU1DLEdBQUcsR0FBR0YsT0FBTyxDQUFDRyxLQUFSLENBQWMscUJBQWQsQ0FBWjs7QUFDQSxNQUFJRCxHQUFHLElBQUlBLEdBQUcsQ0FBQ0UsTUFBSixJQUFjLENBQXpCLEVBQTRCO0FBQ3hCSCxJQUFBQSxJQUFJLEdBQUcsSUFBSUksSUFBSixDQUFTQyxRQUFRLENBQUNKLEdBQUcsQ0FBQyxDQUFELENBQUosQ0FBakIsQ0FBUDtBQUNIOztBQUNELE1BQUksQ0FBQyxrQkFBT0QsSUFBUCxDQUFMLEVBQW1CO0FBQ2YsV0FBTyxJQUFQO0FBQ0g7O0FBQ0QsU0FBT0EsSUFBUDtBQUNIIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0ZVRpbWVDb3VudGVyRW50aXR5VHlwZSwgRGF0ZVRpbWVFbnRpdHlUeXBlLCBNb250aFZhbHVlVHlwZSwgV2Vla1ZhbHVlVHlwZSB9IGZyb20gXCIuLi9kZWNsYXJhdGlvbi9kYXRlXCJcclxuaW1wb3J0IHsgaXNEYXRlLCBpc1N0cmluZyB9IGZyb20gXCIuLi9jb21tb24vZGF0YVwiXHJcbmltcG9ydCB7IHRvSW50IH0gZnJvbSBcIi4uL2NvbW1vbi9jb252ZXJ0XCJcclxuXHJcbi8qKlxyXG4gKiDkuIDlubTnmoTmr6vnp5LmlbDvvIjmjIkzNjDlpKnorqHnrpfvvIlcclxuICovXHJcbmNvbnN0IG1zUGVyWWVhciA9IDMxMTA0MDAwMDAwXHJcbi8qKlxyXG4gKiDkuIDkuKrmnIjnmoTmr6vnp5LmlbDvvIjmjIkzMOWkqeiuoeeul++8iVxyXG4gKi9cclxuY29uc3QgbXNQZXJNb250aCA9IDI1OTIwMDAwMDBcclxuLyoqXHJcbiAqIOS4gOWkqeeahOavq+enkuaVsFxyXG4gKi9cclxuY29uc3QgbXNQZXJEYXkgPSA4NjQwMDAwMFxyXG4vKipcclxuICog5LiA5bCP5pe255qE5q+r56eS5pWwXHJcbiAqL1xyXG5jb25zdCBtc1BlckhvdXIgPSAzNjAwMDAwXHJcbi8qKlxyXG4gKiDkuIDliIbpkp/nmoTmr6vnp5LmlbBcclxuICovXHJcbmNvbnN0IG1zUGVyTWluID0gNjAwMDBcclxuLyoqXHJcbiAqIOS4gOenkumSn+eahOavq+enkuaVsFxyXG4gKi9cclxuY29uc3QgbXNQZXJTZWMgPSAxMDAwXHJcblxyXG4vKipcclxuICog6L+U5Zue5pe26Ze05a6e5L2T5a+56LGhXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gdG9FbnRpdHkoZHQ6IERhdGUpOiBEYXRlVGltZUVudGl0eVR5cGUge1xyXG4gICAgY29uc3QgbW9kZWwgPSB7fSBhcyBEYXRlVGltZUVudGl0eVR5cGVcclxuICAgIG1vZGVsLnllYXIgPSBkdC5nZXRGdWxsWWVhcigpXHJcbiAgICBtb2RlbC5tb250aCA9IChkdC5nZXRNb250aCgpICsgMSkgYXMgTW9udGhWYWx1ZVR5cGVcclxuICAgIG1vZGVsLmRheSA9IGR0LmdldERhdGUoKVxyXG4gICAgbW9kZWwuaG91ciA9IGR0LmdldEhvdXJzKClcclxuICAgIG1vZGVsLm1pbiA9IGR0LmdldE1pbnV0ZXMoKVxyXG4gICAgbW9kZWwuc2Vjb25kID0gZHQuZ2V0U2Vjb25kcygpXHJcbiAgICBtb2RlbC5taWxsaXNlY29uZCA9IGR0LmdldE1pbGxpc2Vjb25kcygpXHJcbiAgICBtb2RlbC53ZWVrID0gZHQuZ2V0RGF5KCkgYXMgV2Vla1ZhbHVlVHlwZVxyXG4gICAgcmV0dXJuIG1vZGVsXHJcbn1cclxuXHJcbi8qKlxyXG4gKiDmoLnmja7mr6vnp5LmlbDov5Tlm57nlKjkuo7orqHml7bnu5/orqHnmoTlrp7kvZNcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiB0b0NvdW50ZXJFbnRpdHkobXM6IG51bWJlcik6IERhdGVUaW1lQ291bnRlckVudGl0eVR5cGUge1xyXG4gICAgY29uc3QgbW9kZWwgPSB7fSBhcyBEYXRlVGltZUNvdW50ZXJFbnRpdHlUeXBlXHJcbiAgICBtb2RlbC55ZWFyID0gMFxyXG4gICAgbW9kZWwubW9udGggPSAwXHJcbiAgICBtb2RlbC5kYXkgPSAwXHJcbiAgICBtb2RlbC5ob3VyID0gMFxyXG4gICAgbW9kZWwubWluID0gMFxyXG4gICAgbW9kZWwuc2Vjb25kID0gMFxyXG4gICAgbW9kZWwubWlsbGlzZWNvbmQgPSAwXHJcblxyXG4gICAgaWYgKG1zIDw9IDApIHtcclxuICAgICAgICByZXR1cm4gbW9kZWxcclxuICAgIH1cclxuXHJcbiAgICBpZiAobXMgPj0gbXNQZXJZZWFyKSB7XHJcbiAgICAgICAgbW9kZWwueWVhciA9IHRvSW50KG1zIC8gbXNQZXJZZWFyKVxyXG4gICAgfVxyXG4gICAgaWYgKG1zID49IG1zUGVyTW9udGgpIHtcclxuICAgICAgICBtb2RlbC5tb250aCA9IHRvSW50KChtcyAlIG1zUGVyWWVhcikgLyBtc1Blck1vbnRoKVxyXG4gICAgfVxyXG4gICAgaWYgKG1zID49IG1zUGVyRGF5KSB7XHJcbiAgICAgICAgbW9kZWwuZGF5ID0gdG9JbnQoKChtcyAlIG1zUGVyWWVhcikgJSBtc1Blck1vbnRoKSAvIG1zUGVyRGF5KVxyXG4gICAgfVxyXG4gICAgaWYgKG1zID49IG1zUGVySG91cikge1xyXG4gICAgICAgIG1vZGVsLmhvdXIgPSB0b0ludCgoKChtcyAlIG1zUGVyWWVhcikgJSBtc1Blck1vbnRoKSAlIG1zUGVyRGF5KSAvIG1zUGVySG91cilcclxuICAgIH1cclxuICAgIGlmIChtcyA+PSBtc1Blck1pbikge1xyXG4gICAgICAgIG1vZGVsLm1pbiA9IHRvSW50KCgoKChtcyAlIG1zUGVyWWVhcikgJSBtc1Blck1vbnRoKSAlIG1zUGVyRGF5KSAlIG1zUGVySG91cikgLyBtc1Blck1pbilcclxuICAgIH1cclxuICAgIGlmIChtcyA+PSBtc1BlclNlYykge1xyXG4gICAgICAgIG1vZGVsLnNlY29uZCA9IHRvSW50KCgoKCgobXMgJSBtc1BlclllYXIpICUgbXNQZXJNb250aCkgJSBtc1BlckRheSkgJSBtc1BlckhvdXIpICUgbXNQZXJNaW4pIC8gbXNQZXJTZWMpXHJcbiAgICB9XHJcbiAgICBtb2RlbC5taWxsaXNlY29uZCA9IHRvSW50KCgoKCgobXMgJSBtc1BlclllYXIpICUgbXNQZXJNb250aCkgJSBtc1BlckRheSkgJSBtc1BlckhvdXIpICUgbXNQZXJNaW4pICUgbXNQZXJTZWMpXHJcbiAgICByZXR1cm4gbW9kZWxcclxufVxyXG5cclxuLyoqXHJcbiAqIOWwhuWtl+espuS4slwiL0RhdGUoLi4uKS9cIueahOaXpeacn+i9rOS4umpzIERhdGXlr7nosaFcclxuICogQHBhcmFtIGRhdGVTdHIgZGF0ZeWtl+espuS4su+8jOWmglwiL0RhdGUoMTQ0MTAzNjgwMDAwMCkvXCJcclxuICogQHJldHVybnMg5aaC5p6c6L2s5o2i5oiQ5Yqf77yM5YiZ6L+U5ZueRGF0ZeWvueixoe+8jOWQpuWImei/lOWbnm51bGxcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBwYXJzZShkYXRlU3RyOiBzdHJpbmcpOiBEYXRlIHwgbnVsbCB7XHJcbiAgICBpZiAoIWRhdGVTdHIgfHwgIWlzU3RyaW5nKGRhdGVTdHIpKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGxcclxuICAgIH1cclxuICAgIGxldCBkYXRlID0gbnVsbFxyXG4gICAgY29uc3QgbXRzID0gZGF0ZVN0ci5tYXRjaCgvKFxcL0RhdGVcXCgoXFxkKylcXClcXC8pLylcclxuICAgIGlmIChtdHMgJiYgbXRzLmxlbmd0aCA+PSAzKSB7XHJcbiAgICAgICAgZGF0ZSA9IG5ldyBEYXRlKHBhcnNlSW50KG10c1syXSkpXHJcbiAgICB9XHJcbiAgICBpZiAoIWlzRGF0ZShkYXRlKSkge1xyXG4gICAgICAgIHJldHVybiBudWxsXHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGF0ZVxyXG59XHJcbiJdfQ==